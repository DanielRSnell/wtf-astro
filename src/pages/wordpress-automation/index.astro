---
export const prerender = false;

import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '@/components/resource-directory.tsx';

// Get all automation resources from the wordpress-resource collection
const automationResources = await getCollection('wordpress-resource', (resource) => {
  const categories = Array.isArray(resource.data.category) 
    ? resource.data.category 
    : [resource.data.category];
  return categories.includes('automation');
});

// Get the category data
const categories = await getCollection('wordpress-category');
const categoryData = categories.find(cat => cat.data.category === 'automation');

// Get automation-related blog posts
const automationPosts = await getCollection('blog', (post) => {
  return post.data.tags?.some(tag => 
    tag.toLowerCase().includes('automation') || 
    tag.toLowerCase().includes('workflow') ||
    tag.toLowerCase().includes('zapier') ||
    automationResources.some(automation => 
      post.data.title.toLowerCase().includes(automation.data.title.toLowerCase()) ||
      post.data.tags?.some(postTag => postTag.toLowerCase().includes(automation.data.title.toLowerCase()))
    )
  );
});

const pageTitle = "Best WordPress Automation Plugins (2025) - Reviews & Comparisons | WooThatsFast";
const pageDescription = "Discover the best WordPress automation plugins and workflow tools of 2025. Expert reviews of automation solutions, workflow builders, and task schedulers. Save time and reduce errors with powerful automation tools for WordPress sites.";

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://woothatsfast.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://woothatsfast.com/wordpress-automation",
        "name": "WordPress Automation Plugins"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://woothatsfast.com/wordpress-automation",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": automationResources.length,
    "itemListElement": automationResources.slice(0, 10).map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://woothatsfast.com/wordpress-automation/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WordPress Automation Plugins",
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="automation"
    title="WordPress Automation"
    description="Streamline your workflow with powerful automation tools"
    resources={automationResources}
    relatedPosts={automationPosts}
    baseUrl="/wordpress-automation"
    categoryData={categoryData}
  />
</Layout>