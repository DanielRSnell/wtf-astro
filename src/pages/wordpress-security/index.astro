---
export const prerender = false;

import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '@/components/resource-directory.tsx';

// Get all security resources from the wordpress-resource collection
const securityResources = await getCollection('wordpress-resource', (resource) => {
  return resource.data.category === 'security';
});

// Get security-related blog posts
const securityPosts = await getCollection('blog', (post) => {
  return post.data.tags?.some(tag => 
    tag.toLowerCase().includes('security') || 
    tag.toLowerCase().includes('firewall') ||
    tag.toLowerCase().includes('malware') ||
    tag.toLowerCase().includes('backup') ||
    securityResources.some(security => 
      post.data.title.toLowerCase().includes(security.data.title.toLowerCase()) ||
      post.data.tags?.some(postTag => postTag.toLowerCase().includes(security.data.title.toLowerCase()))
    )
  );
});

const pageTitle = "Best WordPress Security Plugins (2024) - Reviews & Comparisons | WooThatsFast";
const pageDescription = "Discover the best WordPress security plugins and protection tools of 2024. Expert reviews of firewall plugins, malware scanners, backup solutions, and security hardening tools. Protect your WordPress site from hackers and cyber threats.";

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://woothatsfast.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://woothatsfast.com/wordpress-security",
        "name": "WordPress Security Plugins"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://woothatsfast.com/wordpress-security",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": securityResources.length,
    "itemListElement": securityResources.slice(0, 10).map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://woothatsfast.com/wordpress-security/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WordPress Security Plugins",
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="security"
    title="WordPress Security"
    description="Essential security tools to protect your WordPress site"
    resources={securityResources}
    relatedPosts={securityPosts}
    baseUrl="/wordpress-security"
  />
</Layout>