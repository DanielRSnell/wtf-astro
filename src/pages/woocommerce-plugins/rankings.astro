---
export const prerender = false;

import { getCollection } from 'astro:content';
import Layout from '../../layouts/base.astro';
import { ResourceRanking } from '@/components/resource-ranking.tsx';

// Get all WooCommerce plugin resources from the wordpress-resource collection
const wooPluginResources = await getCollection('wordpress-resource', (resource) => {
  const categories = Array.isArray(resource.data.category) 
    ? resource.data.category 
    : [resource.data.category];
  return categories.includes('woocommerce-plugins');
});

const pageTitle = "Best WooCommerce Plugins 2025 - Expert Rankings | WooThatsFast";
const pageDescription = "Top-rated WooCommerce plugins ranked by functionality, performance, and value. Discover the essential plugins to power up your online store.";

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://woothatsfast.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://woothatsfast.com/woocommerce-plugins",
        "name": "WooCommerce Plugins"
      }
    },
    {
      "@type": "ListItem",
      "position": 3,
      "item": {
        "@id": "https://woothatsfast.com/woocommerce-plugins/rankings",
        "name": "Rankings"
      }
    }
  ]
};

// Filter to only WooCommerce plugins with ratings and sort by average rating
const rankedWooPlugins = wooPluginResources
  .filter(r => r.data.ratings && r.data.ratings.length > 0)
  .map(resource => {
    const ratings = resource.data.ratings || [];
    const avgRating = ratings.length > 0 
      ? ratings.reduce((sum, rating) => sum + rating.value, 0) / ratings.length
      : 0;
    
    return {
      ...resource,
      avgRating
    };
  })
  .sort((a, b) => b.avgRating - a.avgRating)
  .slice(0, 10); // Top 10 WooCommerce plugins

// Create CollectionPage schema with ranked products
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://woothatsfast.com/woocommerce-plugins/rankings",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": rankedWooPlugins.length,
    "itemListElement": rankedWooPlugins.map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://woothatsfast.com/woocommerce-plugins/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WooCommerce Plugins",
      "aggregateRating": {
        "@type": "AggregateRating",
        "ratingValue": resource.avgRating.toFixed(1),
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": resource.data.ratings.length
      }
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceRanking
    client:load
    data-theme="bright-dark"
    title="Top WooCommerce Plugins 2025"
    description="Essential WooCommerce plugins ranked by functionality, performance impact, support quality, and overall value for online stores."
    resources={rankedWooPlugins}
  />
</Layout>