---
export const prerender = false;

import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '@/components/resource-directory.tsx';


// Get all SEO resources from the wordpress-resource collection
const seoResources = await getCollection('wordpress-resource', (resource) => {
  const categories = Array.isArray(resource.data.category) 
    ? resource.data.category 
    : [resource.data.category];
  return categories.includes('seo');
});

// Get the category data
const categories = await getCollection('wordpress-category');
const categoryData = categories.find(cat => cat.data.category === 'seo');

// Get SEO-related blog posts
const seoPosts = await getCollection('blog', (post) => {
  return post.data.tags?.some(tag => 
    tag.toLowerCase().includes('seo') || 
    tag.toLowerCase().includes('search') ||
    seoResources.some(seoTool => 
      post.data.title.toLowerCase().includes(seoTool.data.title.toLowerCase()) ||
      post.data.tags?.some(postTag => postTag.toLowerCase().includes(seoTool.data.title.toLowerCase()))
    )
  );
});

const pageTitle = "Best WordPress SEO Plugins (2025) - Reviews & Comparisons | WooThatsFast";
const pageDescription = "Discover the best WordPress SEO plugins and optimization tools of 2025. Expert reviews of Yoast SEO, RankMath, AIOSEO, and more. Compare features, pricing, and effectiveness to boost your website's search engine rankings and organic traffic.";

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://woothatsfast.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://woothatsfast.com/wordpress-seo",
        "name": "WordPress SEO Plugins"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://woothatsfast.com/wordpress-seo",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": seoResources.length,
    "itemListElement": seoResources.slice(0, 10).map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://woothatsfast.com/wordpress-seo/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WordPress SEO Plugins",
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="seo"
    title="WordPress SEO Plugins"
    description="Powerful SEO tools to improve your WordPress site's search rankings"
    resources={seoResources}
    relatedPosts={seoPosts}
    baseUrl="/wordpress-seo"
    categoryData={categoryData}
  />
</Layout>