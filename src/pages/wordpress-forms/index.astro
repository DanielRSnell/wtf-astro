---
export const prerender = false;

import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '@/components/resource-directory.tsx';

// Get all form resources from the wordpress-resource collection
const formResources = await getCollection('wordpress-resource', (resource) => {
  return resource.data.category === 'forms';
});

// Get form-related blog posts
const formPosts = await getCollection('blog', (post) => {
  return post.data.tags?.some(tag => 
    tag.toLowerCase().includes('form') || 
    tag.toLowerCase().includes('contact') ||
    tag.toLowerCase().includes('gravity') ||
    tag.toLowerCase().includes('wpforms') ||
    formResources.some(form => 
      post.data.title.toLowerCase().includes(form.data.title.toLowerCase()) ||
      post.data.tags?.some(postTag => postTag.toLowerCase().includes(form.data.title.toLowerCase()))
    )
  );
});

const pageTitle = "Best WordPress Form Builders (2024) - Reviews & Comparisons | Blocksy Components";
const pageDescription = "Discover the best WordPress form builders and contact form plugins of 2024. Expert reviews of WPForms, Gravity Forms, Ninja Forms, and more. Compare features, pricing, and integrations to build professional forms for your WordPress site.";

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://blocksy-components.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://blocksy-components.com/wordpress-forms",
        "name": "WordPress Form Builders"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://blocksy-components.com/wordpress-forms",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": formResources.length,
    "itemListElement": formResources.slice(0, 10).map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://blocksy-components.com/wordpress-forms/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WordPress Form Builders",
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="forms"
    title="WordPress Forms"
    description="Professional form builders for every need"
    resources={formResources}
    relatedPosts={formPosts}
    baseUrl="/wordpress-forms"
  />
</Layout>