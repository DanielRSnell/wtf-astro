---
export const prerender = false;

import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '@/components/resource-directory.tsx';

// Get all review resources from the wordpress-review collection
const reviewResources = await getCollection('wordpress-review');

// Get review-related blog posts
const reviewPosts = await getCollection('blog', (post) => {
  return post.data.tags?.some(tag => 
    tag.toLowerCase().includes('review') || 
    tag.toLowerCase().includes('comparison') ||
    reviewResources.some(review => 
      post.data.title.toLowerCase().includes(review.data.title.toLowerCase()) ||
      post.data.tags?.some(postTag => postTag.toLowerCase().includes(review.data.title.toLowerCase()))
    )
  );
});

const pageTitle = "Best WordPress Plugin Reviews (2025) - Reviews & Comparisons | WooThatsFast";
const pageDescription = "Discover comprehensive WordPress plugin reviews and comparisons of 2025. Expert analysis of themes, plugins, hosting, and services. Make informed decisions with detailed reviews, ratings, and feature comparisons for WordPress products.";

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://woothatsfast.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://woothatsfast.com/wordpress-reviews",
        "name": "WordPress Plugin Reviews"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://woothatsfast.com/wordpress-reviews",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": reviewResources.length,
    "itemListElement": reviewResources.slice(0, 10).map((resource, index) => ({
      "@type": "Review",
      "position": index + 1,
      "url": `https://woothatsfast.com/wordpress-reviews/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "itemReviewed": {
        "@type": "Product",
        "name": resource.data.title,
        "category": "WordPress Plugin Reviews"
      },
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="reviews"
    title="WordPress Reviews"
    description="Expert reviews and comparisons of WordPress products"
    resources={reviewResources}
    relatedPosts={reviewPosts}
    baseUrl="/wordpress-reviews"
  />
</Layout>