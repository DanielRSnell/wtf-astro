---
export const prerender = false;
import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '../../components/resource-directory.tsx';
import { getCollection, type CollectionEntry } from 'astro:content';

// Get all block resources from the wordpress-resource collection
const blockResources = await getCollection('wordpress-resource', (resource) => {
  const categories = Array.isArray(resource.data.category) 
    ? resource.data.category 
    : [resource.data.category];
  return categories.includes('wordpress-blocks') || categories.includes('blocks');
});

// Get the category data
const categories = await getCollection('wordpress-category');
const categoryData = categories.find(cat => cat.data.category === 'wordpress-blocks');

// Get block-related blog posts
const blockPosts = await getCollection('blog', (post) => {
  return post.data.tags?.some(tag => 
    tag.toLowerCase().includes('block') || 
    tag.toLowerCase().includes('gutenberg') ||
    tag.toLowerCase().includes('editor') ||
    blockResources.some(block => 
      post.data.title.toLowerCase().includes(block.data.title.toLowerCase()) ||
      post.data.tags?.some(postTag => postTag.toLowerCase().includes(block.data.title.toLowerCase()))
    )
  );
});

const pageTitle = 'Best WordPress Block Plugins (2025) - Reviews & Comparisons | WooThatsFast';
const pageDescription = 'Discover the best WordPress block plugins of 2025. Expert reviews of Gutenberg blocks, custom block collections, and design system solutions. Build beautiful WordPress sites with premium block libraries and advanced Gutenberg extensions.';

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://woothatsfast.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://woothatsfast.com/wordpress-blocks",
        "name": "WordPress Block Plugins"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://woothatsfast.com/wordpress-blocks",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": blockResources.length,
    "itemListElement": blockResources.slice(0, 10).map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://woothatsfast.com/wordpress-blocks/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WordPress Block Plugins",
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="blocks"
    title="WordPress Block Plugins"
    description="Premium Gutenberg blocks and custom block collections for WordPress"
    resources={blockResources}
    relatedPosts={blockPosts}
    baseUrl="/wordpress-blocks"
    categoryData={categoryData}
  />
</Layout>