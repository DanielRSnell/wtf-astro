---
export const prerender = false;

import { getCollection, type CollectionEntry } from 'astro:content';
import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '@/components/resource-directory.tsx';

// Get all performance resources from the wordpress-resource collection
const performanceResources = await getCollection('wordpress-resource', (resource) => {
  return resource.data.category === 'performance';
});

// Get performance-related blog posts
const performancePosts = await getCollection('blog', (post) => {
  return post.data.tags?.some(tag => 
    tag.toLowerCase().includes('performance') || 
    tag.toLowerCase().includes('speed') ||
    tag.toLowerCase().includes('optimization') ||
    tag.toLowerCase().includes('cache') ||
    performanceResources.some(perf => 
      post.data.title.toLowerCase().includes(perf.data.title.toLowerCase()) ||
      post.data.tags?.some(postTag => postTag.toLowerCase().includes(perf.data.title.toLowerCase()))
    )
  );
});

const pageTitle = "Best WordPress Performance Plugins (2024) - Reviews & Comparisons | WooThatsFast";
const pageDescription = "Discover the best WordPress performance plugins and optimization tools of 2024. Expert reviews of caching plugins, speed optimization tools, and performance monitoring solutions. Boost your WordPress site speed with professional optimization plugins.";

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://woothatsfast.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://woothatsfast.com/wordpress-performance",
        "name": "WordPress Performance Plugins"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": pageTitle,
  "description": pageDescription,
  "url": "https://woothatsfast.com/wordpress-performance",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": performanceResources.length,
    "itemListElement": performanceResources.slice(0, 10).map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://woothatsfast.com/wordpress-performance/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WordPress Performance Plugins",
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={pageTitle} 
  description={pageDescription}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="performance"
    title="WordPress Performance"
    description="Tools and techniques to make WordPress lightning fast"
    resources={performanceResources}
    relatedPosts={performancePosts}
    baseUrl="/wordpress-performance"
  />
</Layout>