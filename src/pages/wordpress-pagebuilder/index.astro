---

import Layout from '../../layouts/base.astro';
import { ResourceDirectory } from '../../components/resource-directory.tsx';
import { getCollection } from 'astro:content';

const resources = await getCollection('wordpress-resource', (resource) => {
  const category = resource.data.category;
  if (Array.isArray(category)) {
    return category.includes('wordpress-pagebuilder');
  }
  return category === 'wordpress-pagebuilder';
});

const blogPosts = await getCollection('blog');
const relatedPosts = blogPosts.filter(post => 
  post.data.tags?.some(tag => 
    tag.toLowerCase().includes('builder') || 
    tag.toLowerCase().includes('elementor') ||
    tag.toLowerCase().includes('divi') ||
    tag.toLowerCase().includes('bricks')
  )
);

const title = 'Best WordPress Page Builders (2024) - Reviews & Comparisons | Blocksy Components';
const description = 'Discover the best WordPress page builders of 2024. Expert reviews and comparisons of Elementor, Divi, Bricks Builder, Oxygen, and modern visual development platforms. Build stunning WordPress sites with drag-and-drop page builders.';
const baseUrl = '/wordpress-pagebuilder';

// Create breadcrumb schema
const breadcrumbSchema = {
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "item": {
        "@id": "https://blocksy-components.com",
        "name": "Home"
      }
    },
    {
      "@type": "ListItem",
      "position": 2,
      "item": {
        "@id": "https://blocksy-components.com/wordpress-pagebuilder",
        "name": "WordPress Page Builders"
      }
    }
  ]
};

// Create CollectionPage schema with Product listings
const collectionPageSchema = {
  "@type": "CollectionPage",
  "name": title,
  "description": description,
  "url": "https://blocksy-components.com/wordpress-pagebuilder",
  "breadcrumb": breadcrumbSchema,
  "mainEntity": {
    "@type": "ItemList",
    "numberOfItems": resources.length,
    "itemListElement": resources.slice(0, 10).map((resource, index) => ({
      "@type": "Product",
      "position": index + 1,
      "url": `https://blocksy-components.com/wordpress-pagebuilder/${resource.slug}`,
      "name": resource.data.title,
      "description": resource.data.description,
      "category": "WordPress Page Builders",
      "aggregateRating": resource.data.ratings ? {
        "@type": "AggregateRating",
        "ratingValue": Object.values(resource.data.ratings).reduce((a, b) => a + b, 0) / Object.keys(resource.data.ratings).length,
        "bestRating": "5",
        "worstRating": "1",
        "ratingCount": "1"
      } : undefined
    }))
  }
};
---

<Layout 
  title={title} 
  description={description}
  image="/open-graph.png"
  schemaType="CollectionPage"
  schemaData={collectionPageSchema}
>
  <ResourceDirectory
    client:load
    data-theme="bright-dark"
    category="WordPress Page Builders"
    title={title}
    description={description}
    resources={resources}
    relatedPosts={relatedPosts}
    baseUrl={baseUrl}
  />
</Layout>